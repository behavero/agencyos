# 2026-02-05 Session Notes

## Stats Not Loading (Root Cause Found)

**Problem:** Creators imported successfully (3 creators visible) but all stats showed 0. Console showed "No connected accounts in this agency. Connect the agency admin via OAuth first." for each creator.

**Root Cause:** The stats endpoint (`/api/creators/[id]/stats`) and transaction syncer only looked for tokens in the `models` table. But the agency OAuth token (from "Connect Fanvue") is stored in `agency_fanvue_connections` table. Imported creators don't have personal tokens.

**Fix:**

- `src/app/api/creators/[id]/stats/route.ts` -- Added `import { getAgencyFanvueToken }` and checks `agency_fanvue_connections` first, falls back to `models` table
- `src/lib/services/transaction-syncer.ts` -- Same fix in `getAgencyAdminToken()` function

Commit: `d68b013` - "fix: use agency_fanvue_connections token for stats & transaction sync"

## Live Auto-Refresh System

**Problem:** Stats only updated when user manually clicked "Refresh". Martin wants real-time live data.

**Solution:**

- Created `POST /api/creators/stats/refresh-all` -- bulk endpoint that refreshes all creators in parallel using agency token
- Updated `creator-management-client.tsx`:
  - Auto-refresh on mount if any creator has stats older than 2 minutes
  - Periodic background refresh every 60 seconds
  - "Refresh All" button now uses efficient bulk endpoint

Commit: `2c6b175` - "feat: live stats with auto-refresh and bulk stats API"

## Agent Infrastructure Audit

Reviewed the full agent setup (AGENTS.md, SOUL.md, USER.md, MEMORY.md, TOOLS.md, HEARTBEAT.md, .cursor/rules/, .cursor/agents/). Found:

- USER.md was empty
- MEMORY.md didn't exist
- TOOLS.md was generic template
- HEARTBEAT.md was empty
- .cursor/rules/onyxos.md was outdated (wrong token architecture, stale phase references, leaked secret value)
- .cursor/agents/ had report files mixed with agent definitions
- 30+ stale phase/status markdown files cluttering root

Proceeding with full cleanup and optimization.
